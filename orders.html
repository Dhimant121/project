<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Orders — RedStore</title>
  <style>
    :root{--brand:#2874f0;--muted:#666;--card:#fff;--dark:#111}
    body{font-family:Inter,Segoe UI,Arial,sans-serif;background:#f1f3f6;margin:0;padding:20px}
    .container{max-width:1000px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    h1{margin:0;font-size:24px}
    .nav-link{color:var(--brand);text-decoration:none;padding:8px 12px;border-radius:6px}
    .nav-link:hover{background:#f0f7ff}
    .order-card{background:var(--card);border:1px solid #e6e6e9;border-radius:6px;padding:16px;margin-bottom:16px}
    .order-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f0f0f0;padding-bottom:12px;margin-bottom:12px}
    .order-id{font-weight:700;color:var(--dark)}
    .order-date{color:var(--muted);font-size:13px}
    .order-status{display:inline-block;padding:4px 8px;border-radius:4px;font-size:13px;font-weight:600}
    .status-pending{background:#fff3cd;color:#856404}
    .status-confirmed{background:#d4edda;color:#155724}
    .status-shipped{background:#cfe2ff;color:#084298}
    .status-delivered{background:#d4edda;color:#155724}
    .items-list{margin-bottom:12px}
    .item{display:flex;gap:12px;padding:8px 0;font-size:14px}
    .item-qty{color:var(--muted)}
    .order-total{text-align:right;font-weight:700;font-size:16px;color:var(--dark)}
    .order-action{display:flex;gap:8px;margin-top:12px}
    .btn{padding:8px 12px;border-radius:6px;border:1px solid #e6e6e9;background:#fff;cursor:pointer;font-size:13px;color:var(--brand)}
    .btn:hover{background:#f0f7ff}
    .empty{text-align:center;padding:40px;color:var(--muted)}
    .empty a{color:var(--brand);text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>My Orders</h1>
      <div style="display:flex;gap:12px">
        <a href="/profile.html" class="nav-link">Profile</a>
        <a href="/" class="nav-link">Shop</a>
      </div>
    </header>

    <div id="ordersList">Loading orders...</div>
  </div>

  <script>
    async function fetchJSON(url, opts){ const res = await fetch(url, opts); if(!res.ok) throw await res.json(); return res.json(); }

    async function loadOrders(){
      try {
        const orders = await fetchJSON('/api/orders');
        const container = document.getElementById('ordersList');
        
        if(orders.length === 0){
          container.innerHTML = '<div class="empty">No orders yet — <a href="/">Shop now</a></div>';
          return;
        }

        container.innerHTML = '';
        orders.forEach(order => {
          const date = new Date(order.createdAt).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
          const delivery = new Date(order.estimatedDelivery).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
          
          const card = document.createElement('div');
          card.className = 'order-card';
          card.innerHTML = `
            <div class="order-header">
              <div>
                <div class="order-id">${order.id}</div>
                <div class="order-date">${date}</div>
              </div>
              <span class="order-status status-${order.status.toLowerCase()}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</span>
            </div>
            
            <div class="items-list">
              ${order.items.map(item => `
                <div class="item">
                  <span>${item.title}</span>
                  <span class="item-qty">x${item.qty}</span>
                  <span>₹${item.price}</span>
                </div>
              `).join('')}
            </div>
            
            <div class="order-total">Total: ₹${order.totalAmount}</div>
            
            <div style="color:var(--muted);font-size:13px;margin-top:8px">
              Estimated delivery: ${delivery}
            </div>
            
            <div class="order-action">
              <button class="btn" onclick="showNotification('Track order: ${order.id}')">Track Order</button>
              <button class="btn" onclick="showNotification('Invoice: ${order.id}')">Download Invoice</button>
            </div>
          `;
          container.appendChild(card);
        });
      } catch(err) {
        document.getElementById('ordersList').innerHTML = '<div class="empty">Failed to load orders</div>';
      }
    }

    loadOrders();
  </script>
</body>
</html>